# Progress: issue-136

## Goal
Work on GitHub issue 136: Add batch URL download from input file support.

Use TDD+Trophy (strict red-green-refactor) methodology to implement it.

## Issue Summary
Add support for downloading multiple URLs from an input file, similar to aria2's `-i` / `--input-file` option.

### P0 - MVP Requirements
- `-i, --input-file` flag accepting file path
- One URL per line format
- Skip empty lines and comments (`#`)
- Queue all URLs (respects `--max-concurrent` from #135)
- Continue on individual download failures
- Summary at end: N succeeded, M failed

### P1 - Enhanced Requirements
- Extended format with per-file options (out, dir, header)
- `-` for stdin input (pipe URLs)
- JSON input format option
- `--input-format txt|json` flag

## Status
- Phase: execution
- Started: 2026-01-19

## Learnings (from spec synthesis)

- Queue manager (#142) already merged and handles concurrency limits with priority
- Download command pattern established in `cmd/download.go` - single URL from args
- Cookie parser in `cmd/cookie_parser.go` provides good pattern for line-by-line parsing
- CLI uses `urfave/cli` framework with `cli.StringFlag` for flag definitions
- `dlFlags` slice in `download.go` holds all download-related flags
- Client interface: `client.Download(url, fileName, dir, opts)` returns response
- Background mode (`--background`) already supported - downloads queue and return immediately
- Test patterns: table-driven tests used throughout codebase
- Error handling: `cmd/common` package has `PrintRuntimeErr()` and `PrintErrWithCmdHelp()`

## Synthesis Insights

- Feature is additive, no breaking changes needed
- Input file parsing should be in `cmd/` package (CLI-only feature)
- Batch logic can reuse existing download flow in a loop
- Summary output similar to aria2's batch download summary
- TDD approach: write parser tests first, then batch download tests

## Completed Tasks
- [x] 1.1 Write failing test for input file parser - e378115
- [x] 1.2 Implement input file parser to pass tests - a5e1257
- [x] 1.3 Write failing test for -i flag registration - 63bfb60
- [x] 1.4 Add -i flag to download command - f5f4511

## Current Task
Awaiting next task

## Next
Task 1.5: Write failing test for batch download function

## Execution Log

### Task 1.1: Write failing test for input file parser (RED)
- Created `/Users/divkix/GitHub/warpdl/cmd/input_file_test.go`
- Test cases: BasicURLs, SkipComments, SkipEmptyLines, TrimWhitespace, MixedContent, FileNotFound
- Tests call `ParseInputFile()` which doesn't exist yet
- Verified: `go test -run TestParseInputFile ./cmd/... 2>&1 | grep "undefined"` shows 6 undefined errors
- Status: RED phase complete

### Task 1.2: Implement input file parser (GREEN)
- Created `/Users/divkix/GitHub/warpdl/cmd/input_file.go`
- Implemented `ParseResult` struct with URLs, SkippedLines, TotalLines fields
- Implemented `ParseInputFile()` function:
  - Reads file with `os.ReadFile()`
  - Splits by newlines
  - Trims whitespace, skips empty lines and comments
  - Returns ParseResult with collected URLs
- Verified: `go test -run TestParseInputFile ./cmd/...` - all 6 tests pass
- Status: GREEN phase complete

### Task 1.3: Write failing test for -i flag registration (RED)
- Added `TestDownloadInputFileFlag` test to `/Users/divkix/GitHub/warpdl/cmd/cmd_test.go`
- Test checks if `dlFlags` slice contains a `StringFlag` with name containing "input-file"
- Verified: `go test -run TestDownloadInputFileFlag ./cmd/... 2>&1 | grep "FAIL"` shows test fails
- Error: "download command missing required -i/--input-file flag in dlFlags"
- Status: RED phase complete

### Task 1.4: Add -i flag to download command (GREEN)
- Added `cli.StringFlag` for `input-file, i` to `dlFlags` in `/Users/divkix/GitHub/warpdl/cmd/download.go`
- Flag usage: "read URLs from input file (one URL per line, # for comments)"
- Verified: `go test -run TestDownloadInputFileFlag ./cmd/...` passes
- Verified: `./warpdl download --help | grep input-file` shows flag in help
- Status: GREEN phase complete
