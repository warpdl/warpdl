---
phase: 07-verification-doc-closure
plan: 02
type: execute
wave: 2
depends_on: [07-01]
files_modified:
  - .planning/phases/01-http-redirect/01-VERIFICATION.md
  - .planning/phases/03-ftp-ftps/03-VERIFICATION.md
  - .planning/phases/04-sftp/04-VERIFICATION.md
  - .planning/phases/05-json-rpc-20/05-VERIFICATION.md
  - .planning/phases/02-protocol-interface/02-VERIFICATION.md
  - .planning/REQUIREMENTS.md
autonomous: true
requirements: [REDIR-01, REDIR-02, REDIR-03, PROTO-02, FTP-01, FTP-02, FTP-03, FTP-04, FTP-05, FTP-06, FTP-07, FTP-08, SFTP-01, SFTP-02, SFTP-03, SFTP-05, SFTP-07, SFTP-08, SFTP-09, RPC-01, RPC-02, RPC-03, RPC-04, RPC-05, RPC-07, RPC-08, RPC-09, RPC-10, RPC-12]

must_haves:
  truths:
    - "Every phase (1 through 6) has a VERIFICATION.md file"
    - "All VERIFICATION.md files have result: PASS in frontmatter"
    - "Phase 2 VERIFICATION.md PROTO-02 is SATISFIED (not PARTIAL)"
    - "REQUIREMENTS.md traceability table shows Complete for all 36 requirements"
    - "REQUIREMENTS.md body checkboxes show [x] for all 36 requirements"
    - "REQUIREMENTS.md coverage reads 36/36"
    - "Every requirement in the phase requirements list appears as PASS in at least one VERIFICATION.md"
  artifacts:
    - path: ".planning/phases/01-http-redirect/01-VERIFICATION.md"
      provides: "Phase 1 verification with REDIR-01, REDIR-02, REDIR-03, REDIR-04 all PASS"
    - path: ".planning/phases/03-ftp-ftps/03-VERIFICATION.md"
      provides: "Phase 3 verification with FTP-01 through FTP-08 all PASS"
    - path: ".planning/phases/04-sftp/04-VERIFICATION.md"
      provides: "Phase 4 verification with SFTP-01 through SFTP-09 all PASS (noting SFTP-04/SFTP-06 defect fixed in Phase 6)"
    - path: ".planning/phases/05-json-rpc-20/05-VERIFICATION.md"
      provides: "Phase 5 verification with RPC-01 through RPC-12 all PASS (noting RPC-06/RPC-11 defect fixed in Phase 6)"
    - path: ".planning/phases/02-protocol-interface/02-VERIFICATION.md"
      provides: "Updated Phase 2 verification with PROTO-02 SATISFIED"
    - path: ".planning/REQUIREMENTS.md"
      provides: "Complete traceability table with 36/36 requirements marked Complete"
  key_links:
    - from: "VERIFICATION.md requirements-verified frontmatter"
      to: "REQUIREMENTS.md traceability table"
      via: "3-source cross-reference — every requirement appears in VERIFICATION + SUMMARY + traceability"
    - from: "02-VERIFICATION.md PROTO-02"
      to: "Phase 3/4 factory registrations"
      via: "ftp/ftps/sftp factories now registered in SchemeRouter post-Phase-3/4"
---

<objective>
Create 4 missing VERIFICATION.md files (Phases 1, 3, 4, 5), update Phase 2 VERIFICATION.md (PROTO-02 from PARTIAL to SATISFIED), and update REQUIREMENTS.md traceability table to mark all 36 requirements Complete.

Purpose: This closes the 3-source cross-reference for all 36 requirements. The milestone audit found only 2/36 formally satisfied. After this plan, 36/36 are satisfied across VERIFICATION + SUMMARY + traceability.

Output: 4 new VERIFICATION.md files, 1 updated VERIFICATION.md, 1 updated REQUIREMENTS.md.
</objective>

<execution_context>
@/Users/divkix/.claude/get-shit-done/workflows/execute-plan.md
@/Users/divkix/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/07-verification-doc-closure/07-RESEARCH.md
@.planning/v1.0-MILESTONE-AUDIT.md

Template for VERIFICATION.md format:
@.planning/phases/06-fix-integration-defects/06-VERIFICATION.md

Existing VERIFICATION.md to update:
@.planning/phases/02-protocol-interface/02-VERIFICATION.md

Evidence sources (SUMMARY files created by Plan 07-01):
@.planning/phases/01-http-redirect/01-01-SUMMARY.md
@.planning/phases/01-http-redirect/01-02-SUMMARY.md
@.planning/phases/03-ftp-ftps/03-01-SUMMARY.md
@.planning/phases/03-ftp-ftps/03-02-SUMMARY.md
@.planning/phases/03-ftp-ftps/03-03-SUMMARY.md
@.planning/phases/04-sftp/04-01-SUMMARY.md
@.planning/phases/04-sftp/04-02-SUMMARY.md
@.planning/phases/04-sftp/04-03-SUMMARY.md
@.planning/phases/05-json-rpc-20/05-01-SUMMARY.md
@.planning/phases/05-json-rpc-20/05-02-SUMMARY.md
@.planning/phases/05-json-rpc-20/05-03-SUMMARY.md
@.planning/phases/05-json-rpc-20/05-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VERIFICATION.md files for Phases 1, 3, 4, 5 and update Phase 2</name>
  <files>
    .planning/phases/01-http-redirect/01-VERIFICATION.md
    .planning/phases/03-ftp-ftps/03-VERIFICATION.md
    .planning/phases/04-sftp/04-VERIFICATION.md
    .planning/phases/05-json-rpc-20/05-VERIFICATION.md
    .planning/phases/02-protocol-interface/02-VERIFICATION.md
  </files>
  <action>
    **CRITICAL: This is a documentation-only task. Do NOT create or modify any Go source files.**

    Use `06-VERIFICATION.md` as the template format (cleaner, more recent). All files must have `result: PASS` in frontmatter since all code is implemented and all tests pass post-Phase-6.

    **Create 01-VERIFICATION.md (Phase 1: HTTP Redirect):**

    Frontmatter:
    ```yaml
    ---
    phase: 01-http-redirect
    verified: 2026-02-27
    result: PASS
    requirements-verified: [REDIR-01, REDIR-02, REDIR-03, REDIR-04]
    ---
    ```

    Success criteria from ROADMAP Phase 1:
    - SC1 (REDIR-01): User can download files behind 301/302/303/307/308 redirects transparently.
      Evidence: `pkg/warplib/redirect.go` — RedirectPolicy function. `pkg/warplib/dloader.go` — fetchInfo() follows redirects. `redirect_test.go` — 20+ test cases covering all 3xx codes.
    - SC2 (REDIR-02): All segment requests use final URL after redirect.
      Evidence: `dloader.go` fetchInfo() sets `d.url = resp.Request.URL.String()` after GET.
    - SC3 (REDIR-03): Max hops enforced with clear error on loop.
      Evidence: `redirect.go` — `RedirectPolicy(DefaultMaxRedirects)` enforces 10-hop limit. `ErrTooManyRedirects` error returned. `redirect_test.go` tests loop detection.
    - SC4 (REDIR-04): Authorization headers not leaked cross-origin.
      Evidence: `redirect.go` — `StripUnsafeFromHeaders()` filters unsafe headers. `dloader.go` fetchInfo() detects cross-origin redirect and strips `d.headers`. `proxy.go` — all 3 NewHTTPClient* functions set CheckRedirect. Phase 6 also fixed `web.go` explicit CheckRedirect (defense-in-depth).

    Requirements table: REDIR-01, REDIR-02, REDIR-03, REDIR-04 all PASS with evidence.

    Gate: All tests pass, race clean, build clean, vet clean. (Audit confirmed 19 packages pass.)

    Files modified: List from 01-01-SUMMARY and 01-02-SUMMARY key-files sections.

    **Create 03-VERIFICATION.md (Phase 3: FTP/FTPS):**

    Frontmatter:
    ```yaml
    ---
    phase: 03-ftp-ftps
    verified: 2026-02-27
    result: PASS
    requirements-verified: [FTP-01, FTP-02, FTP-03, FTP-04, FTP-05, FTP-06, FTP-07, FTP-08]
    ---
    ```

    Success criteria from ROADMAP Phase 3:
    - SC1 (FTP-01, FTP-02): User downloads from ftp:// with anonymous auth by default.
      Evidence: `protocol_ftp.go` — newFTPProtocolDownloader defaults to anonymous/anonymous. `protocol_ftp_test.go` — 48+ test cases with ftpserverlib mock server.
    - SC2 (FTP-03): User downloads with ftp://user:pass@host/path credential auth.
      Evidence: URL credential extraction in factory function. TestFTPCredentialAuth passes.
    - SC3 (FTP-06): Resume works via RetrFrom offset.
      Evidence: Resume() uses RetrFrom(path, offset). Manager.ResumeDownload dispatches FTP via SchemeRouter. File offset from WarpStat.
    - SC4 (FTP-07): FTPS with explicit TLS works.
      Evidence: DialWithExplicitTLS used for ftps:// URLs with tls.Config{ServerName: hostname}.
    - SC5 (FTP-04, FTP-05, FTP-08): Passive mode, single stream, file size.
      Evidence: jlaffaye/ftp defaults to EPSV. Capabilities() returns SupportsParallel=false. Probe() calls FileSize, returns in ProbeResult.ContentLength.

    Requirements table: FTP-01 through FTP-08 all PASS.
    Gate: All tests pass, race clean, build clean, vet clean.
    Files: From 03-01/02/03-SUMMARY key-files sections.

    **Create 04-VERIFICATION.md (Phase 4: SFTP):**

    Frontmatter:
    ```yaml
    ---
    phase: 04-sftp
    verified: 2026-02-27
    result: PASS
    requirements-verified: [SFTP-01, SFTP-02, SFTP-03, SFTP-04, SFTP-05, SFTP-06, SFTP-07, SFTP-08, SFTP-09]
    ---
    ```

    Success criteria from ROADMAP Phase 4:
    - SC1 (SFTP-01, SFTP-02): Password auth downloads work.
      Evidence: `protocol_sftp.go` — sftpProtocolDownloader. buildAuthMethods: password from URL takes priority. `protocol_sftp_test.go` — 50+ tests with in-process mock SFTP server.
    - SC2 (SFTP-03): Default SSH key paths used.
      Evidence: buildAuthMethods tries ~/.ssh/id_ed25519, ~/.ssh/id_rsa as defaults.
    - SC3 (SFTP-07): TOFU host key verification.
      Evidence: `known_hosts.go` — TOFU callback, appendKnownHost, KnownHostsPath (~/.config/warpdl/known_hosts). `known_hosts_test.go` — 7 TOFU test functions. Accept first use, reject changed key with MITM error.
    - SC4 (SFTP-06): Resume from byte offset.
      Evidence: Resume() uses sftp.File.Seek(offset, io.SeekStart). Phase 6 fixed custom key persistence (Item.SSHKeyPath).
    - SC5 (SFTP-04, SFTP-08): --ssh-key flag, custom port via URL.
      Evidence: SSHKeyPath threaded CLI -> warpcli -> DownloadParams -> API -> DownloaderOpts -> SFTP factory. Port extracted from URL. Phase 6 fixed SSHKeyPath persistence for resume.

    Requirements table: SFTP-01 through SFTP-09 all PASS. For SFTP-04 and SFTP-06, note: "Initial implementation in Phase 4; resume key persistence defect fixed in Phase 6 (Item.SSHKeyPath field)."
    Gate: All tests pass, race clean, build clean, vet clean.
    Files: From 04-01/02/03-SUMMARY key-files sections.

    **Create 05-VERIFICATION.md (Phase 5: JSON-RPC 2.0):**

    Frontmatter:
    ```yaml
    ---
    phase: 05-json-rpc-20
    verified: 2026-02-27
    result: PASS
    requirements-verified: [RPC-01, RPC-02, RPC-03, RPC-04, RPC-05, RPC-06, RPC-07, RPC-08, RPC-09, RPC-10, RPC-11, RPC-12]
    ---
    ```

    Success criteria from ROADMAP Phase 5:
    - SC1 (RPC-01, RPC-05): curl POST to /jsonrpc with download.add starts download and returns ID.
      Evidence: `rpc_methods.go` — downloadAdd method. `rpc_integration_test.go` — 14 E2E tests.
    - SC2 (RPC-02, RPC-11): WebSocket at /jsonrpc/ws receives real-time progress notifications.
      Evidence: `rpc_notify.go` — RPCNotifier broadcasts download.started/progress/complete/error. `rpc_integration_test.go` — WebSocket notification test.
    - SC3 (RPC-03): Auth token required; bad/missing token returns error.
      Evidence: `rpc_auth.go` — requireToken middleware. Integration tests verify 401 for missing/wrong tokens.
    - SC4 (RPC-04): Localhost binding by default; --rpc-listen-all for all interfaces.
      Evidence: WebServer.addr() returns 127.0.0.1:<port> by default. Integration test verifies binding.
    - SC5 (RPC-05, RPC-07, RPC-08, RPC-09, RPC-10): Method suite returns correct responses.
      Evidence: All methods in rpc_methods.go. Full lifecycle test in integration suite.
    - SC6 (RPC-12): Malformed requests return standard JSON-RPC error codes.
      Evidence: Error codes (-32700, -32601, -32602, -32001, -32002) tested in integration suite.

    Requirements table: RPC-01 through RPC-12 all PASS. For RPC-06 and RPC-11, note: "Initial implementation in Phase 5; resume push notification defect fixed in Phase 6."
    Gate: All tests pass (19 packages), race clean, build clean, vet clean. Coverage >= 80% per package.
    Files: From 05-01/02/03/04-SUMMARY key-files sections.

    **Update 02-VERIFICATION.md (Phase 2: PROTO-02 fix):**

    Make these surgical changes to the existing file:
    1. Frontmatter: Change `status: gaps_found` to `status: PASS` (align with other VERIFICATION files using `result` key)
       Actually, looking at the existing format, change to add/update:
       - Change `status: gaps_found` to `result: PASS` (use `result` key like 06-VERIFICATION.md)
       - Remove `status: gaps_found` line
       - Change `score: 9/10 must-haves verified` to `score: 10/10 must-haves verified`
       - Change `re_verification: false` to `re_verification: true`
       - Add `re_verified: 2026-02-27` after `re_verification`
    2. In the Observable Truths table row 11 (SC1): Change `FAILED` to `VERIFIED`. Update evidence to: "Post-Phase-3/4: ftp/ftps/sftp factories registered in SchemeRouter via NewSchemeRouter(). All 5 schemes dispatch correctly. Re-verified 2026-02-27."
    3. In the Requirements Coverage table: Change PROTO-02 status from `PARTIAL` to `SATISFIED`. Update evidence to add: "Updated 2026-02-27: ftp/ftps/sftp factories now registered after Phase 3/4 shipped. All 5 URL schemes route to correct downloader."
    4. Update the Score line: "10/10 plan must-haves verified"
    5. In Gaps Summary: Add a note at the top: "**Updated 2026-02-27:** Both gaps from initial verification are now resolved. Gap 1 (ROADMAP SC1 scope) resolved by Phase 3/4 shipping ftp/ftps/sftp factories. Gap 2 (REQUIREMENTS.md tracking) resolved by Phase 7 traceability update."

    Do NOT rewrite the entire file. Make targeted edits to the specific sections listed above.
  </action>
  <verify>
    Verify all VERIFICATION files exist and have correct result:
    - `grep 'result: PASS' .planning/phases/01-http-redirect/01-VERIFICATION.md`
    - `grep 'result: PASS' .planning/phases/03-ftp-ftps/03-VERIFICATION.md`
    - `grep 'result: PASS' .planning/phases/04-sftp/04-VERIFICATION.md`
    - `grep 'result: PASS' .planning/phases/05-json-rpc-20/05-VERIFICATION.md`
    - `grep 'result: PASS' .planning/phases/02-protocol-interface/02-VERIFICATION.md`
    - `grep 'SATISFIED' .planning/phases/02-protocol-interface/02-VERIFICATION.md` (PROTO-02)
    - `ls .planning/phases/*/0*-VERIFICATION.md | wc -l` returns 6 (one per phase)
  </verify>
  <done>
    All 6 phases have VERIFICATION.md with result: PASS. Phase 2 PROTO-02 updated from PARTIAL to SATISFIED. Every requirement in the phase requirements list appears as PASS in at least one VERIFICATION.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update REQUIREMENTS.md traceability table and checkboxes</name>
  <files>
    .planning/REQUIREMENTS.md
  </files>
  <action>
    **CRITICAL: This is a documentation-only task. Do NOT create or modify any Go source files.**

    Update `.planning/REQUIREMENTS.md` with the following changes:

    **1. Body checkbox updates ([ ] to [x]):**
    These requirements currently have `[ ]` and need `[x]`:
    - FTP-01 through FTP-08 (8 items)
    - SFTP-01, SFTP-02, SFTP-03, SFTP-05, SFTP-07, SFTP-08, SFTP-09 (7 items — SFTP-04 and SFTP-06 already [x])
    - RPC-01, RPC-02, RPC-03, RPC-04, RPC-05, RPC-07, RPC-08, RPC-09, RPC-10, RPC-12 (10 items — RPC-06 and RPC-11 already [x])

    Total: 25 checkboxes to flip from `[ ]` to `[x]`.

    **2. Traceability table updates (Pending to Complete):**
    These rows currently show `Pending` and need `Complete`:
    - REDIR-01 | Phase 1 | Complete
    - REDIR-02 | Phase 1 | Complete
    - REDIR-03 | Phase 1 | Complete
    - FTP-01 through FTP-08 | Phase 3 | Complete (8 rows)
    - SFTP-01, SFTP-02, SFTP-03, SFTP-05, SFTP-07, SFTP-08, SFTP-09 | Phase 4 | Complete (7 rows)
    - RPC-01 through RPC-05, RPC-07 through RPC-10, RPC-12 | Phase 5 | Complete (10 rows)

    Total: 28 rows to flip from `Pending` to `Complete` (the 3 REDIR rows already have [x] in body but Pending in table).

    Note: REDIR-04, SFTP-04, SFTP-06, RPC-06, RPC-11 are already `Complete` in the table (remapped to Phase 6). PROTO-01, PROTO-02, PROTO-03 are already `Complete`.

    **3. Coverage line update:**
    At the bottom of the Traceability section, update the coverage summary. Current text says:
    ```
    - v1 requirements: 36 total
    - Mapped to phases: 36
    - Unmapped: 0
    ```
    Change to:
    ```
    - v1 requirements: 36 total
    - Complete: 36/36
    - Unmapped: 0
    ```

    **4. Last updated line:**
    Update the footer from:
    `*Last updated: 2026-02-27 after gap closure — 5 defect reqs remapped to Phase 6, 31 remain on original phases (Phase 7 verifies in-place)*`
    To:
    `*Last updated: 2026-02-27 — Phase 7 verification closure: all 36 requirements verified complete across 6 phases*`

    **CROSS-CHECK before writing:** After making all changes, verify:
    - Total [x] checkboxes in body = 36 (4 REDIR + 3 PROTO + 8 FTP + 9 SFTP + 12 RPC)
    - Total `Complete` rows in traceability table = 36
    - Zero `Pending` rows remain
    - Zero `[ ]` checkboxes remain in v1 requirements
  </action>
  <verify>
    Run these checks:
    - `grep -c '\- \[x\]' .planning/REQUIREMENTS.md` should show 36 (all v1 requirements checked)
    - `grep -c '| Pending |' .planning/REQUIREMENTS.md` should show 0
    - `grep -c '| Complete |' .planning/REQUIREMENTS.md` should show 36
    - `grep '36/36' .planning/REQUIREMENTS.md` should match coverage line
  </verify>
  <done>
    REQUIREMENTS.md shows 36/36 requirements complete. All body checkboxes [x]. All traceability rows Complete. Zero Pending entries. Coverage reads 36/36.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the complete 3-source cross-reference:
1. Every phase (1-6) has a VERIFICATION.md with result: PASS
2. Every phase has SUMMARY files with requirements-completed frontmatter for each plan
3. REQUIREMENTS.md traceability table shows Complete for all 36 requirements
4. Phase 2 PROTO-02 shows SATISFIED (not PARTIAL)
5. Coverage reads 36/36

Final validation: For each requirement ID in the phase requirements list, confirm it appears in:
- At least one VERIFICATION.md requirements-verified frontmatter
- At least one SUMMARY.md requirements-completed frontmatter
- REQUIREMENTS.md traceability table as Complete

No Go source files were touched.
</verification>

<success_criteria>
- 4 new VERIFICATION.md files created (Phases 1, 3, 4, 5) with result: PASS
- Phase 2 VERIFICATION.md updated: PROTO-02 SATISFIED, result: PASS
- REQUIREMENTS.md: 36/36 Complete, zero Pending, all [x] checked
- All 28 requirement IDs from phase requirements list appear in at least one VERIFICATION.md and one SUMMARY.md
- Zero Go source files touched
</success_criteria>

<output>
After completion, create `.planning/phases/07-verification-doc-closure/07-02-SUMMARY.md`
</output>
